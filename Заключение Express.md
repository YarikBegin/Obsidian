[[JavaScript]]

Первое знакомство с Express позади. Работать с ним заметно проще, чем писать код на ноде без сторонних библиотек и фреймворков.

Вспомним, что вы изучили в этой теме.

### Роутеры

Роутеры помогают удобно организовать код. Мы можем разбить их на отдельные файлы и передавать как колбэки методам обработки запросов. В экспрессе есть встроенный роутер:

Скопировать кодJAVASCRIPT

```
const router = require('express').Router();

router.get('/users/:id', doesUserExist); 
```

Если все роуты содержатся во входном файле, роутер можно не создавать, а передавать методу `use` самого приложения:

Скопировать кодJAVASCRIPT

```
app.use('/users/:id', doesUserExist); 
```

Роутер удобно использовать, чтобы объединять логику работы с одним эндпоинтом. Например, для работы с пользователями мы можем сделать и передать в приложение такой роутер:

Скопировать кодJAVASCRIPT

```
const router = require('express').Router();

router.get('/', getAllUsers);
router.post('/', createUser);
router.get('/:id', doesUserExist);
router.patch('/:id', updateUser);

app.use('/users', router);  
```

Так мы можем описать логику работы с пользователем, например, в отдельном файле, а затем передать её в приложение. В таком случае у нас будут реализованы методы GET/POST для эндпоинта `/users` и GET/PATCH для эндпоинта `/users/:id`. Удобно!

### Мидлвэры

Основной шаблон экспресса — middleware. Это функции промежуточной обработки, которые выполняются в порядке их добавления. Мидлвэры можно добавлять всему приложению или отдельному роуту:

Скопировать кодJAVASCRIPT

```
// мидлвэра всего приложения
app.use(bodyParser.urlencoded({ extended: true }));

// мидлвэры роута
app.use('/users/:id', checkRequest);
router.get('/users/:id', doesUserExist); 
```

Мидлвэры роутов срабатывают только для запросов, удовлетворяющих шаблону роута, который передаётся первым аргументом, например: `/users/:id`.

Эти функции позволяют организовать код, чтобы его было проще поддерживать. Например, такой код проверяет, есть ли пользователь, и возвращает его, если он есть:

Скопировать кодJAVASCRIPT

```
router.get('/users/:id', doesUserExist);
router.get('/users/:id', sendUser); 
```

Впоследствии, если вы решите добавить функциональность, то уже не будете трогать существующий код, а просто добавите ещё один мидлвэр:

Скопировать кодJAVASCRIPT

```
router.get('/users/:id', doesUserExist);

// добавили промежуточную проверку
router.get('/users/:id', doesUserHavePermission);

router.get('/users/:id', sendUser); 
```

### Готовые пакеты

Если вам в голову приходит какая-то функциональность, скорее всего она уже есть в готовом пакете для экспресса в npm. Такие пакеты подключают к приложению как мидлвэры. Так мы подключали body-parser:

Скопировать кодJAVASCRIPT

```
// подключаем body-parser как мидлвэру всего приложения
app.use(bodyParser.urlencoded({ extended: true })); 
```

Надеемся, вам понравилось работать с экспрессом: с ним код писать проще и быстрее. Мы будем и дальше работать с фреймворком. Эта тема — только начало.