[[Продвинутый JavaScript]]

В прошлом уроке мы говорили об HTTP-запросах. Раньше их можно было делать только автоматически: вы нажимаете на ссылку, браузер отправляет запрос страницы на сервер, получает ответ и отрисовывает сайт.

Со временем это стало неудобно. Например, вы хотите реализовать на сайте чат. При каждой отправке сообщения нужно отрисовывать сайт заново. К тому же, чтобы получить сообщения, придётся обновлять страницу вручную.

Короче, понадобилось отправлять запросы из кода. Для этого был разработан специальный API внутри браузера — `fetch`.

## Метод `fetch`

Метод `fetch` создаёт запрос на сервер и возвращает его ответ. На вход `fetch` принимает два аргумента. Первый — обязательный — URL запрашиваемого ресурса:

Скопировать кодJAVASCRIPT

```
fetch('https://example.com'); 
```

Будьте внимательны и не оставляйте пробелов в конце при указании URL-адреса.

Второй аргумент — необязательный. Это объект опций. Чаще всего нужны опции `method`, `headers` и `body`: они отвечают за метод запроса, его заголовки и тело:

Скопировать кодJAVASCRIPT

```
fetch('https://example.com/users', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    username: 'ivan'
  })
}); 
```

Метод `fetch` асинхронный. Когда вы его вызываете, он создаёт промис, а когда получает ответ — переводит промис в нужный статус. Ответ от сервера при этом записывается в промис, так что его можно использовать через `then` и `catch`:

Скопировать кодJAVASCRIPT

```
fetch('https://example.com')
  .then((res) => {
    console.log(res); // если всё хорошо, получили ответ
  })
  .catch((err) => {
    console.log('Ошибка. Запрос не выполнен');
  }); 
```

Если запрос выполнен успешно, сработает обработчик `then`. Если же что-то пошло не так, — например, отвалился интернет — сработает `catch`.

Вас мог напугать метод `JSON.stringify` или непонятное свойство `headers`. Если это так — не пугайтесь. Скоро ознакомитесь и с тем, и с тем.