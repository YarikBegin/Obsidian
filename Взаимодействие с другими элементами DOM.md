[[Валидация]]

Теперь интерфейс отзывчивый. Пользователь сразу получает полезные сообщения, если он ввёл некорректные данные. Но сохранилась одна проблема. Если пользователь неправильно ввёл данные или оставил поля пустыми, кнопку «Отправить» всё равно можно нажать — она активна.

Поэтому важно работать и с другими элементами интерфейса. В нашем случае это кнопка. В этом уроке вы узнаете, как сделать её неактивной, если хотя бы одно из полей не прошло проверку.

## Пишем недостающие функции

Сейчас функция `isValid` валидирует только один `input`. Но нужно проверить все поля, чтобы настроить статус кнопки. Если все поля валидны — активировать кнопку, если хотя бы одно нет — заблокировать.

Для этого создадим функцию `hasInvalidInput`. Она принимает массив полей формы и возвращает `true`, если в нём хотя бы одно поле не валидно, и `false`, если все валидны.

Для такой проверки подходит метод `some`. Используем его внутри `hasInvalidInput` и пройдём по массиву, чтобы найти невалидный `input`:

Скопировать кодJAVASCRIPT

```
// Функция принимает массив полей

const hasInvalidInput = (inputList) => {
  // проходим по этому массиву методом some
  return inputList.some((inputElement) => {
    // Если поле не валидно, колбэк вернёт true
    // Обход массива прекратится и вся функция
    // hasInvalidInput вернёт true

    return !inputElement.validity.valid;
  })
}; 
```

Функция `hasInvalidInput` только проверяет наличие невалидного поля и сигнализирует, можно ли разблокировать кнопку сабмита. Но она ничего не делает с самой кнопкой «Отправить».

Для стилизации нужна функция `toggleButtonState`. Именно она отключает и включает кнопку. Для этого функция `hasInvalidInput` проверяет валидность полей и возвращает `true` или `false`. На их основе `toggleButtonState` меняет состояние кнопки:

Скопировать кодJAVASCRIPT

```
// Функция принимает массив полей ввода
// и элемент кнопки, состояние которой нужно менять

const toggleButtonState = (inputList, buttonElement) => {
  // Если есть хотя бы один невалидный инпут
  if (hasInvalidInput(inputList)) {
    // сделай кнопку неактивной
    buttonElement.classList.add('form__submit_inactive');
  } else {
    // иначе сделай кнопку активной
    buttonElement.classList.remove('form__submit_inactive');
  }
}; 
```

Функция переключения кнопки готова. Осталось понять, где её вызвать.

Нужно сверять состояние кнопки при каждом изменении полей формы. Поэтому `toggleButtonState` вызывают внутри обработчика события `input`.

Это можно сделать после вызова функции `isValid`:

Скопировать кодJAVASCRIPT

```
const setEventListeners = (formElement) => {
  // Найдём все поля формы и сделаем из них массив
  const inputList = Array.from(formElement.querySelectorAll(`.form__input`));
  // Найдём в текущей форме кнопку отправки
  const buttonElement = formElement.querySelector('.form__submit');

  inputList.forEach((inputElement) => {
    inputElement.addEventListener('input', () => {
      isValid(formElement, inputElement);

      // Вызовем toggleButtonState и передадим ей массив полей и кнопку
      toggleButtonState(inputList, buttonElement);
    });
  });
}; 
```

Теперь кнопка реагирует на корректность данных в каждом поле:

Кнопка отправки формы доступна до начала ввода данных.

Осталась одна проблема. Кнопка блокируется при неверных данных, но до начала их ввода она активна. Чтобы это исправить, нужно заранее вызвать функцию `toggleButtonState` внутри функции `setEventListeners`:

Скопировать кодJAVASCRIPT

```
const setEventListeners = (formElement) => {
  const inputList = Array.from(formElement.querySelectorAll(`.form__input`));
  const buttonElement = formElement.querySelector('.form__submit');

  // Вызовем toggleButtonState, чтобы не ждать ввода данных в поля
  toggleButtonState(inputList, buttonElement);

  // ...
}; 
```

Теперь кнопка заблокирована с самого начала:

Дружелюбный интерфейс помогает пользователю правильно заполнить данные и сразу отловить ошибку. Красные поля с ошибками и не подающая признаков жизни кнопка «Отправить» скорее отобьют желание заполнять форму, чем помогут это сделать. Чем понятнее интерфейс, тем приятнее им пользоваться.

Переходите к заданиям и закрепите полученные знания.