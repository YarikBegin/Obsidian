[[Продвинутый JavaScript]]

Это дополнительный урок. То, что здесь изложено, на практике применяется редко. Поэтому вы можете пропустить этот урок и вернуться к нему после сдачи практической работы.

## Что, если не `fetch`?

В этой теме вы научились делать запросы из JavaScript методом `fetch`. Это современный способ обмена информацией с сервером. Когда мы загружаем данные через `fetch`, браузер не обновляет страницу, а перестраивает нужную часть DOM-дерева. Так сайт работает плавнее и пользователь доволен.

Но возможность обращаться к серверу через JavaScript появилась не сразу. До этого был другой, уже устаревший способ отправить запрос серверу. Возможно, вам не придётся пользоваться этим методом, но его всё равно полезно знать. Потому урок и дополнительный.

Как бы мы ни отправляли данные на сервер, нужна форма. Когда на ней происходит событие `submit`, браузер перезагружает страницу, а данные формы уходят на сервер. Чтобы перезагрузки не происходило, мы отменяли это стандартное поведение формы:

Скопировать кодJAVASCRIPT

```
form.addEventListener('submit', function (evt) {
  evt.preventDefault();
}); 
```

В этом уроке мы разберём, что происходит, если событие `submit` не отменять.

## Поведение по умолчанию

Вёрстка в вебе изначально мало отличалась от бумажной. В начале 90-х сайт выглядел как журнал: можно было переходить от страницы к странице, просматривать изображения и текст. Но со временем этого стало мало — нужно было научить сайты получать и отправлять на сервер данные от пользователя. Для этого и были придуманы формы.

Работа с формами была организована так: пользователь вводит данные и отправляет форму на сервер. Для этого браузер формирует запрос. Чтобы сформировать адрес запроса и его тело, браузер должен как-то сообщить серверу, какие данные к какому полю относятся. Для этого формы были наделены атрибутами. Именно об этих атрибутах и пойдёт речь.

## Атрибуты форм

У тегов, относящихся к форме (`form`, `input`, `select`), есть специальные атрибуты. Они отвечают за то, как эта форма будет отправлена (если использовать стандартное поведение).

Рассмотрим простую форму регистрации:

Скопировать кодHTML

```
<form id="form">
  <label for="username">
    Имя пользователя
    <input type="text" name="username" id="username">
  </label>
  <label for="email">
    Email
    <input type="email" name="email" id="email">
  </label>
  <label for="password">
    Пароль
    <input type="password" name="password" id="password">
  </label>
    <button type="submit">Отправить</button>
</form> 
```

При нажатии «Отправить» страница перезагрузится, а в адресной строке появится:

Скопировать код

```
<путь к файлу с кодом>/index.html?username=&email=&password= 
```

Что же произошло?

Когда мы нажали «Отправить», браузер сформировал запрос c определёнными параметрами: `?username=&email=&password=`. Он взял их из атрибутов `name` полей ввода, а после знака равенства вставил значения этих параметров. Получилась строка, состоящая из пар «атрибут=значение», разделённых амперсандами. В нашем примере значения пустые, потому что мы не заполняли форму, а просто нажали «Отправить».

Дальше браузер отправил на сервер GET-запрос. По умолчанию запрос уйдёт к тому же ресурсу, от которого получена веб-страница, но это поведение можно изменить.

В нашем примере запрос будет отправлен на такой адрес:

Скопировать код

```
<путь к файлу с кодом>/index.html 
```

У такого способа отправки данных есть ощутимые недостатки:

1.  GET-запросы подходят для отправки нечувствительных данных. Пароль, email, имя пользователя, личные данные отправлять так нельзя — это небезопасно.
2.  В GET-запрос можно уместить примерно 3000 знаков, отправить длинный текст так не выйдет.
3.  GET-запрос лучше использовать для получения данных, а для отправки использовать POST-запрос. Так и вам, и другим разработчикам будет понятно, что каждый запрос делает: запрашивает данные или отправляет.

## Настройка запроса

Есть способ исправить все эти недостатки — использовать атрибуты `action` и `method`.

Первый — `action` — позволяет указать путь к обработчику — серверной программе, которой предстоит обрабатывать форму. Как мы уже говорили, по умолчанию запрос уйдёт к тому же ресурсу, с которого загрузилась страница. Как раз атрибут `action` позволяет это изменить.

Второй атрибут — `method` — даёт возможность задать метод, которым данные формы нужно отправлять. Может принимать два значения: GET и POST.

В полях ввода, мы указали атрибут `name`. С помощью этого атрибута данные, введённые в определённое поле, будут присвоены значению, которое указано в атрибуте `name`. Допустим, мы указали в поле «Имя пользователя» значение `супер фронтенд`, в поле «email» — `vasyafrontend@yandex.ru`, а в поле пароля — `12345678`. Тогда, при отправке методом GET будет сформирована строка:

Скопировать код

```
*<путь к файлу с кодом>/register?username=супер фронтенд&email=vasyafrontend@yandex.ru&password=12345678* 
```

При отправке методом POST — это будет преобразовано в объект `FormData`, из которого на сервере эти данные можно будет получить по значению ключа — по аналогии с обычным JavaScript объектом.

Скопировать кодHTML

```
<form id="form" action="/register" method="POST">
  <label for="username">
    Имя пользователя
    <input type="text" name="username" id="username">
  </label>
  <label for="email">
    Email
    <input type="email" name="email" id="email">
  </label>
  <label for="password">
    Пароль
    <input type="password" name="password" id="password">
  </label>
    <button type="submit">Отправить</button>
</form> 
```

Методами PUT, PATCH и DELETE стандартно отправить форму никак не выйдет.

### Кодировка данных

Как мы уже сказали, все данные, которые ввёл пользователь, попадают либо в адресную строку, либо в тело запроса. Но как именно составить такую строку или такое тело? Есть несколько способов. Какой именно из них использовать, указывают в атрибуте `enctype`. Он может принимать одно из трёх значений:

1.  `application/x-www-form-urlencoded`
    
    Значение по умолчанию. При таком способе кодирования все латинские символы и цифры останутся, пробелы будут заменены плюсами (+), а русские буквы и другие спецсимволы — на шестнадцатиричные коды.
    
    Вот как будут выглядеть данные формы:
    
    Скопировать код
    
    ```
     %3C%D0%BF%D1%83%D1%82%D1%8C%20%D0%BA%20%D1%84%D0%B0%D0%B9%D0%BB%D1%83%20%D1%81%20%D0%BA%D0%BE%D0%B4%D0%BE%D0%BC%3E%2Fregister%3Fusername%3D%D1%81%D1%83%D0%BF%D0%B5%D1%80%20%D1%84%D1%80%D0%BE%D0%BD%D1%82%D0%B5%D0%BD%D0%B4%26email%3Dvasyafrontend%[40yandex.ru](http://40yandex.ru/)%26password%3D12345678
      
    ```
    
2.  `multipart/form-data`
    
    Этот тип кодирования можно использовать только с запросами, у которых есть тело. То есть, если вы отправляете форму стандартным образом, — с POST-запросами. Работает он так: все данные разбиваются на пары «атрибут=значение», разделённые какой-то строкой. Эту строку-разделитель можно генерировать случайно или указать в заголовке Content-Type. Дальше данные без каких-либо преобразований отправляются в теле запроса, а не в URL. Этот способ кодирования обычно используют для отправки файлов.
    
3.  `text/plain` заменяет пробелы на плюсы, а сами данные — не трогает. При этом данные формы будут выглядеть так:
    
    Скопировать код
    
    ```
     <путь к файлу с кодом>/register?username=супер+фронтенд&email=vasyafrontend@yandex.ru&password=12345678
      
    ```
    
    А код так:
    
    Скопировать кодHTML
    
    ```
     <form id="form" action="/register" method="POST" enctype="text/plain">
       <label for="username">
         Имя пользователя
         <input type="text" name="username" id="username">
       </label>
       <label for="email">
         Email
         <input type="email" name="email" id="email">
       </label>
       <label for="password">
         Пароль
         <input type="password" name="password" id="password">
       </label>
         <button type="submit">Отправить</button>
     </form>
      
    ```
    

В современном коде обработкой форм всегда занимается JavaScript. Способ отправки запросов, описанный в этом уроке, может пригодиться, если вы разбираете старый код. Либо если хотите заставить сайт работать, даже если у пользователя JavaScript отключён.

Этот урок не принёс вам практических навыков. Зато теперь вы можете достичь в своих проектах лучшего взаимопонимания между клиентом и сервером. Даже безо всякой поддержки со стороны JavaScript.