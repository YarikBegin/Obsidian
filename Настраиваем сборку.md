[[Объектно-ориентированное программирование. Введение]] 

Во втором уроке мы говорили, что сборка — процесс превращения множества ваших файлов с кодом в один большой. У одного проекта может быть несколько сборок, по одной под каждую цель.

Обычно в проекте есть две сборки: одна для разработки, другая для конечного пользователя. Разработка и использование — разные процессы, поэтому и требования к сборкам разные:

В сборке для разработки

В сборке для использования

Старый синтаксис и вендорные префиксы

**Не нужны**. Они не несут полезной информации и засоряют код.

**Нужны**. Закрывают проблему совместимости в разных браузерах.

Вебпак

**Нужен**. При изменении кода проект нужно собрать.

**Не нужен**. Проект уже собран, не надо собирать его второй раз

«Вебпаку» нужно как-то объяснить, что в какую сборку включать, какие утилиты запускать и что делать с кодом. Для всего этого есть специальные разделы внутри файла package.json. В уроке расскажем как раз об этих разделах, и как ими пользоваться.

## Выбираем вид сборки. Раздел scripts

Сборка кода осуществляется последовательностью команд. Каждая команда определяет действие: скопировать строки кода, удалить пробелы, добавить префиксы. Получается длинная инструкция: какие файлы нужны, что с ними делать и куда в итоге всё складывать.

Сама логика каждой команды уже прописана под капотом у «Вебпака». Нам лишь нужно организовать их в правильную последовательность — скрипт. Такие скрипты прописывают в разделе scripts файла package.json. «Из коробки» этот раздел выглядит так:

Скопировать кодJSON

```
"scripts": {
  "test": "echo \"Error: no test specified\" && exit 1",
} 
```

Любой скрипт запускается командой `npm run имя скрипта`. В нашем файле package.json пока только один скрипт, он называется `test`. Запустим его:

Скопировать кодBASH

```
npm run test
# Появится сообщение об ошибке 
```

Нам такой скрипт не нужен — удалим его. И вместо него напишем скрипт для сборки проекта:

Скопировать кодJSON

```
"scripts": {
  "build": "webpack"
} 
```

Теперь у нас есть скрипт `build`. В него мы записали команду `webpack`. Так мы скомандовали Node.js найти в папке `node_modules` модуль `webpack` и запустить его.

## Определяем точку входа

При модульном подходе у вас в проекте находится множество файлов. Одни файлы подключают к другим директивой `import`.

Во время сборки «Вебпак» заходит в файл и добавляет его код в итоговый код. Затем повторяет ту же операцию для каждого подключённого через `import` файла. Так «Вебпак» собирает код всех файлов в один большой.

Но «Вебпаку» нужно как-то понять, куда идти в первую очередь, — точку входа. По умолчанию точка входа — файл `index.js` внутри папки `src`. Поэтому создайте в папке своего проекта директорию `src`, а в ней — файл `index.js`.

Теперь всё готово к сборке. Запустите её командой `npm run build`.

В папке вашего проекта появится директория `dist`, а внутри неё — файл `main.js`. В этот файл будет приходить весь js-код вашего проекта (уже очень скоро).

## Каждый раз новая сборка

В течение этой темы вы настроите «Вебпак» так, что в папку `dist` будут попадать все файлы проекта: html, css, js, картинки, шрифты. В процессе разработки проекта в нём могут появляться новые файлы, а старые, наоборот, удаляться.

Чтобы в папке `dist` не скапливались файлы, её лучше очищать перед каждой сборкой. Самый простой способ сделать это — добавить в скрипт `build` удаление папки `dist` перед сборкой.

**Если у вас Windows.** Для этого допишите `rd /s /q dist &&` в build-скрипте:

Скопировать кодJSON

```
"scripts": {
  "build": "rd /s /q dist && webpack", // добавили удаление папки
} 
```

**Если у вас macOS.** Для этого допишите `rm -rf dist &&` в build-скрипте:

Скопировать кодJSON

```
"scripts": {
  "build": "rm -rf dist && webpack", // добавили удаление папки
} 
```

Теперь перед каждой сборкой папка `dist` будет удаляться, а в сборку будут попадать только самые свежие файлы.

**Кроссплатформенное решение.** В конечном счёте разработчики используют разные ОС, поэтому круто найти возможность выполнять скрипт на любой ОС. Такое решение есть и мы расскажем про него через несколько уроков. А пока — про локальный сервер.

Скопировать кодJSON

```
"scripts": {
  "build": "rimraf dist && webpack" // добавили удаление папки
} 
```

## Настраиваем локальный сервер

Директивы `import` и `export` не работают без сервера — такова их внутренняя логика. Поэтому без сервера невозможно проверить, как работает модульный код.

На помощь приходит локальный сервер. Это настоящий сервер у вас на компьютере, но подключиться к нему можете только вы. Для разработки как раз то, что нужно.

Устанавливаете локальный сервер → получаете все серверные возможности, в том числе и работу модулей.

В проектной работе прошлого спринта вы установили локальный сервер как расширение в текстовый редактор. А сейчас установим локальный сервер как зависимость в проект. Такой локальный сервер интегрирован с «Вебпаком»: это упростит разработку.

Локальный сервер — тоже утилита. Её можно получить из NPM командой `npm i webpack-dev-server --save-dev`. Выполните эту команду, и утилита добавится в `devDependencies` файла `package.json` . Локальный сервер ещё предстоит настроить, но подготовка проведена.

## Создаём вторую сборку

Одной сборки недостаточно. Мы не можем добавлять локальный сервер в финальную сборку — он нужен только при разработке. Но и без локального сервера нам не обойтись.

Всё, что остаётся, — создать отдельную сборку для разработки. Для этого пропишем её в разделе `scripts` файла `package.json`:

Скопировать кодJSON

```
"scripts": {
  "build": "rm -rf dist && webpack",
  "dev": "webpack serve"
} 
```

Теперь нам доступен ещё один скрипт — `npm run dev`. Команда `webpack serve` запустит проект на локальном сервере.

В следующем уроке мы добавим в эту сборку дополнительные инструменты, полезные только для разработки проекта, поэтому укажем явно, что первая сборка для финальной подготовки файлов к публикации:

Скопировать кодJSON

```
"scripts": {
  "build": "rm -rf dist && webpack --mode production",
  "dev": "webpack serve"
} 
```

## Собираем проект

Вызовите из терминала команду `npm run dev`. Откроется ваш проект на локальном сервере — по адресу `localhost:8080`. Пока проект пустой, вы видите интерфейс для просмотра файлов на сервере, то есть файлов вашего проекта.

Обратите внимание: пока сервер работает, новых команд в Git bash создать не получится. Выхода два:

1.  Завершить выполнение локального сервера. Для этого нажмите Ctrl + C. Если вы работаете в Git Bash для Windows, это единственный способ продолжить работу с терминалом.
2.  В терминале для macOS и Linux есть вкладки — прямо как в браузере. Вы можете открыть несколько вкладок, и работа в каждой из них не будет влиять на работу других. Чтобы создать новую вкладку, нажмите Cmd + T (macOS) или Ctrl +Shift + T (Linux).

Теперь окружение настроено: две отдельные сборки для разработки и для финальной версии продукта. Кроме того, теперь у нас есть локальный сервер, а вместе с ним и модули JS.

Всё это время мы устанавливали пакеты. В следующем уроке перейдём к их настройке.

### Задание

1.  Запустите сборку командой `npm run dev`;

2.  Перейдите по адресу [`http://localhost:8080`](http://localhost:8080/) в вашем браузере, и вы увидите ошибку загрузки страницы: “Cannot GET /”. Это нормально, страницу мы сделаем позже.

[[Настроим Webpack]]