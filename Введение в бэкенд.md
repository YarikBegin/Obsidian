[[JavaScript]]

Ещё недавно веб работал так: пользователь обращался к серверу, а тот возвращал готовую HTML-страницу с разметкой и данными внутри. В этом случае один инструмент отвечал как за работу с данными, так и за их представление, то есть данные смешивались с разметкой.

![image](https://pictures.s3.yandex.net/resources/13.2_01_v02_1630311932.png)

_Так работает сервер, который сочетает в себе роли фронтенда и бэкенда_

У такого подхода есть несколько недостатков:

- при переходе между страницами браузер пользователя перезагружает всю страницу, а не только изменившиеся данные. Это замедляет работу сайта, особенно если страницы тяжёлые;
- код в браузере работает с готовой разметкой, поэтому когда пользователь изменяет данные, интерфейсу требуется дополнительное время, чтобы найти на странице нужный фрагмент;
- сильная связность серверной и клиентской частей. Чтобы внести изменения в клиентскую часть, требуется редактировать код сервера. Это затрудняет и замедляет разработку.

Для преодоления этих проблем разработчики решили разделить веб на фронтенд и бэкенд.

![image](https://pictures.s3.yandex.net/resources/13.2_02_v02_1630311968.png)

Фронтенд — «лицо приложения», его интерфейс, доступный в браузере. Через него пользователь взаимодействует с сервисом.

Бэкенд — «сердце и мозг» приложения. Задача бэкенда — обработать запрос фронтенда и вернуть ему соответствующую информацию. После этого фронтенд решает, как эти данные обработать и отобразить.

Быть бэкенд-разработчиком — значит нести ответственность за данные пользователя. Именно бэкендер решает, как эти данные обрабатываются и хранятся на сервере, в каком виде попадают на клиент. И это лишь малая часть задач, с которыми бэкендер сталкивается регулярно. В работе ему помогают разные инструменты и технологии, часть из которых вам предстоит изучить.

## Инструменты бэкенда

![image](https://pictures.s3.yandex.net/resources/Untitled_4_1643375041.png)

Первое, с чем сталкивается разработчик при переходе на бэкенд, — изменение среды выполнения кода. Код бэкенда работает не в браузере пользователя, а на специальным образом сконфигурированном компьютере, доступном по сети, — сервере. Бэкенд может быть написан на разных языках программирования, но мы будем использовать привычный JavaScript и среду выполнения Node.js, или «ноду». Нода запускает JavaScript-код бэкенда и обеспечивает ему доступ к файлам, сети и другим программам. Node.js — JavaScript-движок, а не браузер, поэтому в ноде отсутствуют браузерные API, к примеру fetch и DOM.

Не так быстро, одного JavaScript для бэкенда мало. Чтобы принять запрос от пользователя, нужен веб-сервер. При получении запроса на бэкенде выполняются стандартные операции: определяется тип этого запроса, извлекаются параметры и тело. Затем вызывается функция-обработчик, которая соответствует запросу, и результат её выполнения возвращается клиенту. Это задачи, с которыми разработчик сталкивается регулярно, поэтому для их решения применяют специальный веб-фреймворк — Express.

Express содержит набор «кирпичиков» — функций для стандартного веб-сервера Node.js. Они предназначены, чтобы описывать последовательности типовых действий, которые выполняются при обработке входящего запроса. Это позволяет абстрагироваться от скучной рутины и сфокусироваться на главном — логике приложения.

На бэкенде могут возникать ошибки, которые приводят к нарушению работы сервиса, искажению или даже потере данных. Поэтому важно следить, что всё работает корректно, а при возникновении проблем — анализировать их. В этом нам помогают логи. Они содержат информацию о запросе пользователя, процессе его обработки и ошибках, которые могут возникнуть при этом. С помощью логов мы узнаём точную последовательность действий, которые приводят к ошибке.

Для Node.js существует множество модулей логирования, но мы остановимся на одном — `winston` — он гибкий и его просто настраивать. Для winston существует специализированный модуль-обёртка `express-winston`, который упрощает подключение логера к Express. С ним подключение логера в Express реализуется несколькими строками кода, после добавления которых мы получаем детальную информацию о работе сервиса.

После обработки входящих запросов нужно разобраться, как хранить данные приложения. И если на фронтенде объём этих данных исчислялся десятками и сотнями элементов, на бэкенде мы часто оперируем сотнями и тысячами записей. Привычные JS-объекты и массивы оказываются для таких объёмов неудобны и часто неприменимы. Данные могут «не влезать» в оперативную память сервера, а поиск по ним — долгая и неэффективная задача. Кроме этого, хранить данные в приложении — ненадёжно, ведь они теряются при его перезапуске. Так что для этой цели в бэкенде используют базы данных (БД). В рамках курса вы познакомитесь с базой данных MongoDB и библиотекой Mongoose, которая позволяет работать с данными в БД как с привычными JS-объектами.

Другая важная задача на бэкенде — авторизация пользователей и управление доступом. Часто от разработчика требуется сделать доступной какую-то функциональность только для определённых пользователей или их групп. Для этого нужно знать, как:

- безопасно хранить данные пользователей;
- аутентифицировать их;
- связывать запросы с учётной записью;
- сопоставлять роль, которая требуется для запроса, с ролью пользователя.

Чтобы связать запрос и пользователя приложения, к первому прикладывается специальный идентификатор — токен. Когда сервер получает запрос, он извлекает информацию из токена, «опознаёт» пользователя и проверяет его полномочия. Если полномочий пользователя недостаточно, чтобы запрос выполнился, сервер прерывает обработку запроса и возвращает пользователю ошибку.

Для управления токенами существует множество решений, но одно из самых популярных — стандарт JWT. В этом спринте вы реализуете выпуск и проверку JWT-токенов, а также систему доступа на их основе.

После разработки бэкенда нужно развернуть его в боевой среде — сделать доступным из сети. При запуске приложения в продакшене разработчики применяют специальные инструменты, которые отслеживают состояние бэкенда — и в случае его падения автоматически перезапускают.

Для решения этой задачи вы изучите процессный менеджер pm2. Он не только мониторит состояние, но и предоставляет информацию о производительности приложения и потреблении ресурсов в реальном времени. Кроме этого, pm2 может запускать несколько копий приложения с распределением нагрузки между ними. Это позволяет разработчику использовать ресурсы сервера по максимуму, а приложению — работать быстрее, что важно, когда с ним одновременно взаимодействует много пользователей.

Вы познакомились с некоторыми задачами и вызовами, которые ожидают вас на бэкенде. Но они не должны вас пугать, ведь вы уже знаете, что любую задачу можно решить с помощью специального инструмента. Настало время попробовать это в деле. Сервер, как говорится, сам себя не напишет. Вы готовы?