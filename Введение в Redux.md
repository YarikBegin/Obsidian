[[React]]

Redux — небольшая библиотека, которая позволяет организовать управление данными в JavaScript-приложениях. Библиотеку Redux создал российский разработчик Дэн Абрамов в 2015 году, когда ему было 23 года. С тех пор Дэн работает в основной команде React в Facebook и является одной из самых заметных фигур в современной веб-разработке.

С помощью Redux можно создать нечто похожее на базу данных прямо в JavaScript-приложении. Такая база представляет из себя обычный JavaScript-объект и называется хранилищем (англ. “store”). Во многом этот способ организации данных похож на React Context, однако Redux представляет из себя более сложную и функциональную концепцию.

### Основная идея Redux

В хранилище могут содержаться абсолютно все данные приложения и все переменные состояний, влияющие на интерфейс. Например, в нём можно хранить любые API-данные, идентификатор текущей страницы или состояние диалоговых окон (открыто/закрыто).

### Преимущества

При таком подходе у приложения появляется единый «источник правды» для его полного состояния в отдельно взятый момент времени.

Например, JS-объект можно легко сохранить в постоянное хранилище браузера (`LocalStorage`) и быстро восстановить после обновления страницы. Так пользователь увидит тот же самый интерфейс, который он видел, когда посещал страницу в последний раз.

С другой стороны это может быть полезно при отладке ошибок. Если возникает ошибка, можно легко восстановить полное состояние хранилища и воспроизвести её. Это сложнее сделать, если информация «размазана» по внутренним состояниям отдельных компонентов приложения. По этой же причине в Redux-приложениях легче писать юнит-тесты.

### «Иммутабельность»

Важнейшая концепция Redux — неизменяемость или иммутабельность (англ. “immutability”) объекта хранилища. Это означает, что при любом изменении данных в хранилище вместо внесения изменений в существующий объект, на его основе создаётся новая, изменённая копия. Чаще всего для этого используется оператор spread `...` и методы массивов типа `map`. Сравните два этих примера:

Скопировать кодJSX

```
const store = { title: 'Hello', name: 'Gregory' };

// Прямое изменение исходного объекта:
store.name = 'James';

// Создание нового объекта на основе исходного:
const newStore = { ...store, name: 'James' }; 
```

При таком подходе можно легко определить, изменились ли данные: достаточно сравнить `newStore === store`. Также можно вести историю изменений и если нужно, «откатиться» к предыдущей версии. Это бывает полезно при отладке приложения.

### Принцип работы Redux

Библиотека Redux работает по такому алгоритму:

1.  Хранилище никогда не изменяется напрямую. Чтобы произвести изменения в хранилище, нужно отправить (англ. “dispatch”) в него «экшн» (англ. “action”, событие). Экшн — это JavaScript-объект, который всегда должен иметь ключ `type`. Он также может содержать дополнительные данные. Экшены отправляются в хранилище методом `store.dispatch`.
2.  Внутри этого метода все новые экшены передаются на обработку «редьюсеру» (от англ. “reduce”, свёртывать) — функции, которую должен описать сам разработчик. Каждый раз редьюсер получает на вход новый экшн вместе с актуальным значением хранилища. В зависимости от типа экшена и данных в нём редьюсер создаёт новый объект хранилища на основе предыдущего (как в примере выше) и возвращает его. Основной редьюсер обычно состоит из нескольких дочерних редьюсеров, каждый из которых отвечает за обработку своего «участка» общего хранилища.
3.  После окончания работы редьюсера новое значение, которое он вернул, заменяет текущее значение хранилища и вызываются функции-обработчики. Предварительно эти функции нужно установить с помощью метода `store.subscribe`. Таким образом разработчик получает доступ к новому значению хранилища и может произвести изменения в DOM.

![image](https://pictures.s3.yandex.net/resources/Untitled_5_1652801328.png)

### Redux и React

Redux — универсальная библиотека и используется не только в «Реакте». Например, многие используют её вместе с фреймворком Angular. Чтобы подключить Redux именно к «Реакту» применяют «соединительную» библиотеку [react-redux](https://react-redux.js.org/).

Она предоставляет разработчику «Реакт-компонент» `Provider` (почти как тот, что был в React Context), а также функцию `connect`. Эта функция позволяет подключить хранилище к отдельным компонентам и использовать его данные, превращая их в пропсы.

### Недостатки и альтернативы

Некоторые разработчики не любят Redux из-за его «многословности». Для его использования обычно приходится писать много однотипного кода. В проекте быстро разрастается число экшенов и их типов, а также самих редьюсеров и других вспомогательных сущностей.

В то же время принципы Redux полезны для крупных проектов с большим количеством изменяющихся данных. Поэтому периодически появляются альтернативные, упрощённые реализации. Например, [библиотека ReactN](https://www.npmjs.com/package/reactn).