[[JavaScript]]

Мы говорили, что основные флаги — это `g`, `i` и `m`. Первые два мы объяснили, а об `m` обещали рассказать позже. В этом уроке поговорим о спецсимволах, обозначающих начало и конец строки. А это как раз позволит разобраться с флагом `m`.

## Начало строки и конец строки

Начнём с начала. Спецсимвол, обозначающий начало строки, — шляпка `^`, или карет. Он говорит шаблону, что нужно искать совпадение только с началом текста:

Скопировать кодJAVASCRIPT

```
const regex = /^\d+/g;
const newReg = /\d+/g;
const    str = '2001 год: Космическая одиссея, вышел в 1968 году';

str.match(regex); // [ "2001" ];
str.match(newReg); // [ "2001", "1968" ]; 
```

Символ конца строки — знак доллара `$`. Аналогично указывает, что нужно искать совпадение с концом текста:

Скопировать кодJAVASCRIPT

```
const regex = /\d+$/;
const    str = 'https://praktikum.yandex.ru/trainer/frontend-developer/lesson/45';

str.match(regex); // ( ["45"] ) 
```

## Многострочные тексты

Чтобы написать многострочный текст, перенос можно поставить комбинацией символов `\n` или пользоваться обычными переносами в шаблонных строках:

Скопировать кодJAVASCRIPT

```
const str1 = `Председатель Совнаркома, Наркомпроса, Мининдела!
Эта местность мне знакома, как окраина Китая!`;
const str2 = 'Это утро, радость эта,\nЭта мощь и дня и света,' 
```

Тут есть расхождение между логикой компьютера и человека. Для нас перенос означает, что строка закончилась. А для движка всё иначе — он считает началом строки только то, что стоит после открывающей кавычки, а концом — до закрывающей:

Скопировать кодJAVASCRIPT

```
const str = `Председатель Совнаркома, Наркомпроса, Мининдела!
Эта местность мне знакома, как окраина Китая!`;
const regex = /[А-Я]*!$/gi; // найдём последние слова каждой строки

str.match(regex); // ["Китая!"] — получилось только последнее слово всего текста 
```

Чтобы изменить такое поведение движка, нужно установить флаг `m`. Тогда движок будет считать каждый перенос концом одной строки и началом другой:

Скопировать кодJAVASCRIPT

```
const str = `Эта личность мне знакома! Знак допроса вместо тела.
Многоточие шинели. Вместо мозга — запятая.`;
const regex = /[А-Я]*\.$/gim;

str.match(regex); // [ "тела.", "запятая." ] 
```

Это работает и с шаблонными строками, и с обычными: в них движок будет считать началом и концом строки комбинации `\n`:

Скопировать кодJAVASCRIPT

```
const regex = /^I got/gm;
const    str = 'I got, I got, I got, I got\n' +
                    'Loyalty, got royalty\n' +
                    'Inside my DNA\n' +
                    'Coconut quarter piece, got war and peace\n' +
                    'Inside my DNA\n' + 
                    'I got power, poison, pain and joy\n' +
                    'Inside my DNA\n' +
                    'I got hustle, though, ambition, flow\n' +
                    'Inside my DNA'

str.match(regex); // [ "I got", "I got", "I got" ] 
```

## Трудности с точкой

В многострочных текстах точка работает плохо, потому что не учитывает конца строки. Попробуем найти самую длинную строку (считаем с конца), которая состоит из любых символов:

Скопировать кодJAVASCRIPT

```
const regex = /.*$/;
const regexMultiline = /.*$/m;
const    str = 'I got, I got, I got, I got\n' +
                    'Loyalty, got royalty\n' +
                    'Inside my DNA\n' +
                    'Coconut quarter piece, got war and peace\n' +
                    'Inside my DNA\n' + 
                    'I got power, poison, pain and joy\n' +
                    'Inside my DNA\n' +
                    'I got hustle, though, ambition, flow\n' +
                    'Inside my DNA'

str.match(regexMultiline); // [ "I got, I got, I got, I got" ]

/* Флаг m включён, поэтому движок отсчитал
сколько мог любых символов от конца первой строки */

str.match(regex); // [ "Inside my DNA" ]

/* Тут флаг m выключен, поэтому движок отсчитывает
символы от конца строки. Точка в шаблоне означает
любой символ, кроме переноса. Поэтому мы нашли
только последнюю строчку */
 
```

При работе с многострочным текстом точка иногда подводит — она означает любой символ, кроме конца строки. Поэтому, если нужно искать совпадение с абсолютно любым символом, пользуйтесь набором `[\s\S]`:

Скопировать кодJAVASCRIPT

```
const regex = /[\s\S]*$/;  // вариант с началом строки: /^[\s\S]*/;
const    str = 'I got, I got, I got, I got\n' +
                    'Loyalty, got royalty\n' +
                    'Inside my DNA\n' +
                    'Coconut quarter piece, got war and peace\n' +
                    'Inside my DNA\n' + 
                    'I got power, poison, pain and joy\n' +
                    'Inside my DNA\n' +
                    'I got hustle, though, ambition, flow\n' +
                    'Inside my DNA'

// Теперь мы получим весь текст целиком

str.match(regex); // [ "I got, I got, I got, I got\nLoyalty, got royalty\nInside my DNA\nCoconut quarter piece, got war and peace\nInside my DNA\nI got power, poison, pain and joy\nInside my DNA\nI got hustle, though, ambition, flow\nInside my DNA" ] 
```

Таким образом, начало строки обозначают шляпкой `^`, а конец — знаком доллара `$`. По умолчанию весь текст — одна строка, у которой есть один конец и одно начало.

Такое поведение движка можно изменить, поставив флаг `m`. Флаг `m` говорит движку, чтобы тот воспринимал каждый перенос как конец одной строки и начало другой.