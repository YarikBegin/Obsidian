[[JavaScript]]

При работе с данными важны скорость и надёжность. Этого не достичь без баз данных. Но прежде, чем изучать прикладные инструменты, нужно понять общую логику организации данных. Существуют два подхода: реляционные и нереляционные базы данных. В этом уроке расскажем, что представляет собой каждый подход и какой лучше выбрать.

## Реляционные БД

Такие базы данных состоят из таблиц и связей между ними. Для написания запросов к ним используют специальный язык SQL.

Таблицы в реляционных БД похожи на те, с которыми вы работали в Excel. Они состоят из колонок-полей и строк. Первое — характеристики, а второе — записи.

Разберёмся в работе реляционных БД на примере. Представьте, что вам нужно написать интернет-магазин. Кроме этого, вам потребуется разобраться с организацией данных — сделать так, чтобы пользователи могли регистрироваться и смотреть историю заказов. И если то, как должен выглядеть фронтенд, кажется интуитивно понятным, то над хранением данных придётся немного подумать.

Сперва нужно выделить сущности: товар, пользователь и заказ. Они связаны между собой, например, у пользователя может быть несколько заказов, а заказы содержат товары.

Нужно заранее определиться со структурой данных, ведь столбцы для каждой сущности будут общими.

Сложим в таблицу товары:

![image](https://pictures.s3.yandex.net/resources/Untitled_1569319786.png)

И пользователей:

![image](https://pictures.s3.yandex.net/resources/Untitled1_1569319869.png)

Отлично. Теперь Стасу нужна ещё одна таблица — таблица заказов. Каждый заказ относится к какому-то пользователю и содержит один или несколько товаров. Нам не нужно хранить здесь информацию о каждом товаре и пользователе. Достаточно указать идентификатор пользователя и идентификатор товара:

![image](https://pictures.s3.yandex.net/resources/Untitled2_1569320045.png)

Чтобы составить список товаров и отрисовать его на стороне клиента, нужно сделать запрос к базе данных, который возьмёт имя каждого товара из таблицы «Товары» и сгруппирует данные по таблице «Заказы», взяв оттуда только товары нужного пользователя.

В этом и состоит суть реляционных баз данных. Информация организована в таблицы с предопределённой структурой. Мы можем добавить столбец, но тогда каждый элемент таблицы получит ещё один параметр. Мы можем получить информацию, которая нигде не содержится — список товаров с названиями. Для этого используют связи между таблицами.

Стас сдал проект, и Виталий Сергеевич доволен. Когда пользователь заходит на страницу «История заказов», он делает запрос к базе. Запрос на ходу собирает данные из разных таблиц и предоставляет их пользователю.

У такого подхода есть плюсы и минусы. Данные разделены по разным таблицам. Каждая таблица содержит информацию только о тех сущностях, за которые отвечает. В таблице «Товары» есть всё о товарах и никакой информации о заказах или пользователях. Аналогично с таблицей «Пользователи».

Тем не менее таблиц может быть десятки и сотни. Чем больше таблиц нужно обойти запросу, тем больше производительности нужно серверу. Мы можем поставить более мощный процессор и добавить оперативной памяти, но продолжать это до бесконечности не выйдет — в какой-то момент мы упрёмся в потолок производительности. Эту проблему решают нереляционные базы данных.

## Нереляционные БД

Нереляционные БД обычно не используют язык запросов SQL, принятый для реляционной модели, поэтому их называют NoSQL.

Вместо таблиц в этих БД используют коллекции — нежёсткие структуры данных, которые состоят из документов. Объясним на примере.

Вас просят добавить функциональность в интернет-магазин: если пользователь совершил покупку, ему дают скидку на следующий товар.

При реляционном подходе вы написали бы код так, что при оформлении заказа к базе отправлялся бы запрос: «Проверь, есть ли в таблице „Заказы“ вот такой идентификатор». Исходя из этого высчитывалась бы скидка.

В нереляционной БД другой подход. При заказе достаточно давать пользователю параметр, который бы говорил, что заказ уже сделан. Тогда не нужно проводить дополнительный поиск по базе заказов:

Скопировать кодJAVASCRIPT

```
{
    "id": "1234252",
    "name": "Внук Виталия Сергеевича",
    "madeOrder": true
},
{
    "id": "1208772",
    "name": "Стас Басов",
} 
```

Это и есть документ, который хранит пользователей. Мы не привязаны к жёсткой структуре: у одного пользователя есть свойство `"madeOrder"`, а другого — нет.

Тут вы подумали и решили: «А переделаю всё в нереляционную БД!» Сначала вы переписали таблицу с товарами в документ:

Скопировать кодJAVASCRIPT

```
// Документ с товарами
{
    "id": "19960",
    "name": "Волшебная палочка Гарри Поттера",
    "price": 10,
    "amount": 15
},
{
    "id": "79789",
    "name": "Автомобиль Delorean DMC-12",
    "price": 500,
    "amount": 7
},
{
    "id": "51339",
    "name": "Световой меч Люка Скайуокера",
    "price": 15,
    "amount": 3
},
{
    "id": "16307",
    "name": "Посох Гэндальфа",
    "price": 20,
    "amount": 2
} 
```

Затем то же сделали с таблицей пользователей:

Скопировать кодJAVASCRIPT

```
// Документ с пользователями
{
    "id": "85334",
    "name": "Вито Корлеоне",
    "age": 63
},
{
    "id": "48222",
    "name": "Николас Кейдж в роли Джона Траволты",
    "age": 55
},
{
    "id": "87130",
    "name": "Джон Траволта в роли Николаса Кейджа",
    "age": 65
},
{
    "id": "17185",
    "name": "Лягушонок Пепе",
    "age": 14
} 
```

Вам осталось оформить таблицу с заказами. Тут и выявляется основное отличие реляционных баз данных от нереляционных. В последних мы не будем делать запрос, который пойдёт в связанные таблицы, а просто соберём все нужные данные в одном месте:

Скопировать кодJAVASCRIPT

```
// Документ с заказами
{
    "id": "39439",
    "user": {
        "id": "48222",
        "name": "Николас Кейдж в роли Джона Траволты",
        "age": 55
    },
    "items": [
        {
            "id": "19960",
            "name": "Волшебная палочка Гарри Поттера",
            "price": 10,
            "amountOrdered": 2
        },
        {
            "id": "79789",
            "name": "Автомобиль Delorean DMC-12",
            "price": 500,
            "amountOrdered": 1
        },
        {
            "id": "51339",
            "name": "Световой меч Люка Скайуокера",
            "price": 15,
            "amountOrdered": 1
        }
    ]
},
{
    "id": "48241",
    "user": {
            "id": "17185",
            "name": "Лягушонок Пепе",
            "age": 14
        },
    "items": [
        {
            "id": "16307",
            "name": "Посох Гэндальфа",
            "price": 20,
            "amountOrdered": 1
        },
        {
            "id": "51339",
            "name": "Световой меч Люка Скайуокера",
            "price": 15,
            "amountOrdered": 1
        }
    ]
},
 
```

Теперь не нужно собирать данные о заказах, можно просто взять их из документа с товарами. Плюс такого метода в скорости и простоте обработки запроса. Минус — в необходимости дублировать одни и те же данные. Если пользователь изменит имя, придётся менять его и в документе с заказами.

## Какую базу выбрать?

Общего ответа на этот вопрос нет. Всё зависит от задачи, которую вы решаете.

Реляционные БД сильно нагружают процессор и оперативную память сервера. Такие базы масштабируются вертикально, то есть заменой сервера на более мощный.

Нереляционные БД можно масштабировать горизонтально, то есть добавлять новые серверы. На одном сервере разместить пользователей, на другом — заказы, на третьем — товары. Это делает базу данных практически неограниченно масштабируемой.

Мы выбрали нереляционный подход. Почему — расскажем в следующем уроке.

Какие базы данных лучше?

Реляционные

Нереляционные

Правильный ответ

Зависит от задачи

Стасу заказали сделать базу данных для приложения заметок. Каждая заметка может содержать фотографии, текст и ссылки. Какую лучше выбрать БД?

Реляционную

В реляционной БД такое организовать было бы непросто. Структура каждого документа — заметки — не определена заранее. Поэтому лучше выбрать нереляционную базу.

Правильный ответ

Нереляционную

Правильно! Структура каждого документа — заметки — не определена заранее. Поэтому лучше выбрать нереляционную базу.

Крупной компании нужна внутренняя соцсеть для сотрудников. Каждый пользователь сети обладает именем, фамилией и должностью. Также он относится к какому-то департаменту и может принимать участие во внутренних инициативах. Например, вступить в благотворительный комитет. Какая база данных подойдёт лучше для решения этой задачи?

Правильный ответ

Реляционная

Верно. Реляционная база отлично подходит для управления отношениями. Поскольку каждый сотрудник может переходить из одного департамента в другой, получать повышение и вступать в комитеты, нет смысла дублировать информацию о работнике в отдельных коллекциях. Лучше воспользоваться отношениями.

Нереляционная

Какие факторы следует учитывать при выборе базы данных?

Тоже правильный ответ

Предпочтения команды;

Тоже правильный ответ

на каком языке пишет бэкендер;

погода за окном;

Правильный ответ

планы по масштабированию;

Неправильный ответ

мощность серверного железа.

Практически любой сервис можно сделать как на реляционной, так и на нереляционной базе данных. Безусловно, каждая БД обладает своими преимуществами и недостатками, но они начинают выявляться только когда проект становится действительно большим.