[[JavaScript]]

В прошлом уроке мы изменили место хранения JWT: вместо localStorage стали использовать куки. Хотя мы и решили проблему доступности токена из JS-кода, появилась другая проблема — уязвимость к CSRF-атаке. CSRF-атака (Cross Site Request Forgery, англ. «межсайтовая подделка запроса») построена на том, что вместе с http-запросом браузер посылает куки соответствующего домена.

Если обратиться к сайту с другого домена, браузер всё равно отправит куки. Так злоумышленник может разместить на своём сайте форму, которая отправляет запрос на наш сервер. Пользователь зайдёт на этот вредоносный сайт, и от его имени будет отправлен авторизованный запрос на наш домен.

## Это ужасно. Как защититься?

Самый простой способ защиты от автоматической отправки кук — указать браузеру, чтобы тот посылал куки, только если запрос сделан с того же домена. Для этого есть опция `sameSite`:

Скопировать кодJAVASCRIPT

```
res
  .cookie('jwt', token, {
    maxAge: 3600000,
    httpOnly: true,
    sameSite: true // добавили опцию
  })
  .end(); // если у ответа нет тела, можно использовать метод end 
```

Так большинство пользователей оказываются защищены. Мы говорим «большинство», потому что same site — относительно новая опция, и в старых браузерах она не работает. Поэтому пользователей, у которых браузер не поддерживает `sameSite`, лучше попросить обновиться.